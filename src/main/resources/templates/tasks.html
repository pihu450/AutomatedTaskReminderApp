<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>All Tasks</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>

<body>

<div class="container">

    <h2>All Tasks</h2>

    <!-- FLASH MESSAGES -->
    <div th:if="${successMessage}" class="flash flash-success" th:text="${successMessage}"></div>
    <div th:if="${errorMessage}" class="flash flash-error" th:text="${errorMessage}"></div>

    <!-- FILTER / SEARCH -->
    <form class="filters" action="/api/tasks/tasks" method="get">

        <label>Status :</label>
        <select name="status" class="filter-input">
            <option value="">All</option>
            <option th:each="s : ${T(com.tracker.app.enums.TaskStatus).values()}"
                    th:value="${s}"
                    th:text="${s}"
                    th:selected="${param.status == s.name()}">
            </option>
        </select>

        <label>Priority :</label>
        <select name="priority" class="filter-input">
            <option value="">All</option>
            <option th:each="p : ${T(com.tracker.app.enums.TaskPriority).values()}"
                    th:value="${p}"
                    th:text="${p}"
                    th:selected="${param.priority == p.name()}">
            </option>
        </select>

        <label>Search Title :</label>
        <input type="text" name="keyword"
               class="filter-input small"
               placeholder="keyword"
               th:value="${param.keyword}"/>

        <input type="hidden" name="sort" th:value="${param.sort}"/>

        <button type="submit" class="btn">Filter</button>

        <a href="/api/tasks/add" class="btn btn-primary">Add Task</a>
        <a href="/api/tasks/tasks" class="btn small">Clear</a>

        <span class="small" style="margin-left:12px;">
        Sort :
        <a th:href="@{/api/tasks/tasks(sort='dueDate',status=${param.status},priority=${param.priority},keyword=${param.keyword})}">Due Date</a> |
        <a th:href="@{/api/tasks/tasks(sort='priority',status=${param.status},priority=${param.priority},keyword=${param.keyword})}">Priority</a> |
        <a th:href="@{/api/tasks/tasks(sort='title',status=${param.status},priority=${param.priority},keyword=${param.keyword})}">Title</a>
    </span>

    </form>

    <!-- TASK TABLE -->
    <table class="task-table">
        <thead>
        <tr>
            <th>ID</th>
            <th>Title</th>
            <th>Description</th>
            <th>Due Date</th>
            <th>Status</th>
            <th>Priority</th>
            <th>Created At</th>
            <th>Actions</th>
        </tr>
        </thead>

        <tbody>
        <tr th:each="task : ${task}">
            <td th:text="${task.id}"></td>
            <td th:text="${task.title}"></td>
            <td th:text="${task.description}"></td>
            <td th:text="${#temporals.format(task.dueDate, 'dd-MM-yyyy')}"></td>
            <td th:text="${task.status}"></td>
            <td th:text="${task.priority}"></td>
            <td th:text="${#temporals.format(task.createdAt, 'dd-MM-yyyy HH:mm')}"></td>
            <td>
                <a th:href="@{/api/tasks/edit/{id}(id=${task.id})}">Edit</a> |
                <a th:href="@{/api/tasks/delete/{id}(id=${task.id})}"
                   onclick="return confirm('Are you sure you want to delete this task?');">
                    Delete
                </a>
            </td>
        </tr>
        </tbody>
    </table>

</div>
</body>
</html>
